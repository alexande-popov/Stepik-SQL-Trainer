Исходная таблица `book`:
```
+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+
```
## Mатематические функции
* `CEILING(x)` округляет до целого числа в большую сторону
* `FLOOR(x)` округляет до  целого числа в меньшую сторону
* `ROUND(x,y)` округляет значение x до k знаков после запятой, если k не указано – x округляется до целого
* `POWER(x, y)`, `SQRT(x)` – x в степени y, квадратный корень
* `DEGREES(x)`, `RADIANS(x)` радианы в градусы и обратно
* `ABS(x)` модуль
* `PI()`
Полный список: https://learn.microsoft.com/ru-ru/sql/t-sql/functions/mathematical-functions-transact-sql?view=sql-server-ver15

## Логическая функция `IF()`
```
IF(логическое_выражение, выражение_1, выражение_2)
```
Функция вычисляет `логическое_выражение`, если оно истина – в поле заносится значение `выражения_1`, 
в противном случае –  значение `выражения_2`. Все три параметра IF() являются обязательными.

**Пример**

Для каждой книги из таблицы book установим скидку следующим образом: если количество книг меньше 4, то скидка будет составлять 50% от цены, в противном случае 30%.
```SQL
SELECT title, amount, price, 
    IF(amount < 4, price * 0.5, price * 0.7) AS sale
FROM book;
```

**Пример**

Усложним вычисление скидки в зависимости от количества книг. Если количество книг меньше 4 – то скидка 50%, меньше 11 – 30%, в остальных случаях – 10%. 
И еще укажем какая именно скидка на каждую книгу.
```SQL
SELECT title, amount, price,
    ROUND(IF(amount < 4, price * 0.5, IF(amount < 11, price * 0.7, price * 0.9)), 2) AS sale,
    IF(amount < 4, 'скидка 50%', IF(amount < 11, 'скидка 30%', 'скидка 10%')) AS Ваша_скидка
FROM book;
```
Результат:
```
+-----------------------+--------+--------+--------+-------------+
| title                 | amount | price  | sale   | Ваша_скидка |
+-----------------------+--------+--------+--------+-------------+
| Мастер и Маргарита    | 3      | 670.99 | 335.50 | скидка 50%  |
| Белая гвардия         | 5      | 540.50 | 378.35 | скидка 30%  |
| Идиот                 | 10     | 460.00 | 322.00 | скидка 30%  |
| Братья Карамазовы     | 2      | 799.01 | 399.51 | скидка 50%  |
| Стихотворения и поэмы | 15     | 650.00 | 585.00 | скидка 10%  |
+-----------------------+--------+--------+--------+-------------+
```
### Задание
При анализе продаж книг выяснилось, что наибольшей популярностью пользуются книги Михаила Булгакова, на втором месте книги Сергея Есенина. 
Исходя из этого решили поднять цену книг Булгакова на 10%, а цену книг Есенина - на 5%. 
Написать запрос, куда включить автора, название книги и новую цену, последний столбец назвать `new_price`. 
Значение округлить до двух знаков после запятой.
```SQL
SELECT author, title, 
    ROUND(IF(author = "Булгаков М.А.", 1.1 * price,
          IF(author = "Есенин С.А." , 1.05 * price, price)),2) AS new_price
FROM book;
```
Результат:
```
+------------------+-----------------------+-----------+
| author           | title                 | new_price |
+------------------+-----------------------+-----------+
| Булгаков М.А.    | Мастер и Маргарита    | 738.09    |
| Булгаков М.А.    | Белая гвардия         | 594.55    |
| Достоевский Ф.М. | Идиот                 | 460.00    |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01    |
| Есенин С.А.      | Стихотворения и поэмы | 682.50    |
+------------------+-----------------------+-----------+
```
## Выборка данных по условию `WHERE`
Если в итоговую выборку нужно включить не все строки, а только те, которые удовлетворяют условию, то используют ключевое слово `WHERE`.

Операторы сравнения: 
```
=, <>, >, <, >=, <=
```
**Пример**

Вывести книги, суммарная стоимость которых больше 4000 рублей.
```SQL
SELECT title, author, price * amount AS total
FROM book
WHERE price * amount > 4000;
```
Результат:
```
+-----------------------+------------------+---------+
| title                 | author           | total   |
+-----------------------+------------------+---------+
| Идиот                 | Достоевский Ф.М. | 4600.00 |
| Стихотворения и поэмы | Есенин С.А.      | 9750.00 |
+-----------------------+------------------+---------+
```
**Замечание.** В логическом выражении после `WHERE` нельзя использовать названия столбцов, присвоенные им с помощью `AS`,  так как при выполнении запроса сначала вычисляется логическое выражение для каждой строки исходной таблицы, выбираются строки, для которых оно истинно. А только после этого формируется "шапка запроса" – столбцы, включаемые в запрос.

## Логические операции
Приоритет:
1. круглые скобки
2. умножение  (\*),  деление (/)
3. сложение  (+), вычитание (-)
4. операторы сравнения (=, >, <, >=, <=, <>), BETWEEN, IN
5. NOT
6. AND
7. OR

**Пример**

Вывести книги, которые написал Булгаков или Есенин, ценой больше 600 рублей.
```SQL
SELECT title, author, price FROM book
WHERE (author = 'Булгаков М.А.' OR author = 'Есенин С.А.') AND price > 600;
```
Альтернативно:
```SQL
SELECT title, author, price FROM book
WHERE author IN ('Булгаков М.А.', 'Есенин С.А.') AND price > 600;
```
### Задание
Вывести название и авторов тех книг, цены которых принадлежат интервалу от 540.50 до 800 (включая границы),  а количество или 2, или 3, или 5, или 7 .
```SQL
SELECT title, author FROM book
WHERE price BETWEEN 540.50 AND 800 
AND amount IN (2,3,5,7);
```
## Сортировка `ORDER BY`
Если после `ORDER BY` указывается несколько столбцов, то вначале происходит сортировка по первому столбцу, потом, если в первом столбце есть одинаковые значения,
то происходит сортировка по второму столбцу и т.д.
* `ASC` по возрастанию (по умолчанию)
* `DESC` по убыванию

Столбцы после ключевого слова `ORDER BY` можно задавать:
* названием столбца;
* номером столбца;
* именем столбца (указанным после `AS`)

То есть ззапросы
```SQL
SELECT title, author, price FROM book ORDER BY title;
```
и
```SQL
SELECT title, author, price FROM book ORDER BY 1;
```
аналогичны.
```SQL
+-----------------------+------------------+--------+
| title                 | author           | price  |
+-----------------------+------------------+--------+
| Белая гвардия         | Булгаков М.А.    | 540.50 |
| Братья Карамазовы     | Достоевский Ф.М. | 799.01 |
| Идиот                 | Достоевский Ф.М. | 460.00 |
| Мастер и Маргарита    | Булгаков М.А.    | 670.99 |
| Стихотворения и поэмы | Есенин С.А.      | 650.00 |
+-----------------------+------------------+--------+
```
**Пример**

Вывести автора, название и количество книг, в отсортированном в алфавитном порядке по автору и по убыванию количества, для тех книг, цены которых меньше 750 рублей.
```SQL
SELECT author, title, amount AS Количество FROM book WHERE price < 750
ORDER BY author, Количество DESC;
```
```
+------------------+-----------------------+------------+
| author           | title                 | Количество |
+------------------+-----------------------+------------+
| Булгаков М.А.    | Белая гвардия         | 5          |
| Булгаков М.А.    | Мастер и Маргарита    | 3          |
| Достоевский Ф.М. | Идиот                 | 10         |
| Есенин С.А.      | Стихотворения и поэмы | 15         |
+------------------+-----------------------+------------+
```
### Задание
Вывести  автора и название  книг, количество которых принадлежит интервалу от 2 до 14 (включая границы). Информацию  отсортировать сначала по авторам (в обратном алфавитном порядке), а затем по названиям книг (по алфавиту).
```SQL
SELECT author, title FROM book
WHERE amount BETWEEN 2 AND 14
ORDER BY author DESC, title ASC;
```
